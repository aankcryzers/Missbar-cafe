<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MissBar Cafe</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #fbbf24;
      --secondary: #f87171;
      --accent: #2563eb;
      --nav-bg: #fff;
      --nav-border: #e5e7eb;
      --nav-active: #fbbf24;
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #f8fafc;
      font-family: 'Montserrat', Arial, sans-serif;
      color: #222;
      min-height: 100vh;
    }
    .font-cafe {
      font-family: 'Montserrat', Arial, sans-serif;
      font-weight: bold;
      letter-spacing: 1px;
    }
    .page {
      min-height: 100vh;
      padding-bottom: 4.5rem;
      display: none;
      animation: fadein .2s;
    }
    .page.active {
      display: block;
    }
    @keyframes fadein {
      from { opacity: 0 }
      to   { opacity: 1 }
    }
    .form-box {
      max-width: 22rem;
      margin: 2.5rem auto 0 auto;
      background: #fff;
      border-radius: 1rem;
      box-shadow: 0 2px 12px #0001;
      padding: 2rem;
    }
    .input {
      width: 100%;
      padding: 0.75rem 1rem;
      margin-bottom: 1rem;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      font-size: 1rem;
    }
    .btn {
      padding: 0.7rem 1.2rem;
      font-size: 1rem;
      border: none;
      border-radius: 0.5rem;
      background: var(--primary);
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      transition: background .2s;
    }
    .btn:hover {
      background: #f59e42;
    }
    .link {
      color: var(--accent);
      text-decoration: underline;
      cursor: pointer;
    }
    .nav-bottom {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      background: var(--nav-bg);
      border-top: 1.5px solid var(--nav-border);
      display: flex;
      justify-content: space-around;
      z-index: 50;
      height: 4.2rem;
      box-shadow: 0 -2px 12px #0001;
    }
    .nav-btn {
      flex: 1 1 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #888;
      background: none;
      border: none;
      font-size: .86rem;
      cursor: pointer;
      transition: color .2s;
      height: 100%;
    }
    .nav-btn.active, .nav-btn:focus {
      color: var(--nav-active);
    }
    .nav-btn svg { display: block; margin-bottom: .2rem;}
    .container {
      max-width: 900px;
      margin: 1.5rem auto;
      background: #fff;
      border-radius: 1rem;
      box-shadow: 0 2px 12px #0001;
      padding: 1.2rem 1rem 1.2rem 1rem;
    }
    .menu-grid, .menu-table {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px,1fr));
      gap: 1rem;
    }
    .menu-item, .menu-table-item {
      background: #f9fafb;
      border-radius: 0.7rem;
      box-shadow: 0 2px 8px #0001;
      padding: 1rem 0.5rem 0.7rem 0.5rem;
      text-align: center;
    }
    .menu-item img, .menu-table-item img {
      width: 100%;
      height: 100px;
      object-fit: cover;
      border-radius: 0.6rem;
      margin-bottom: .3rem;
      background: #eee;
    }
    .menu-item .btn, .menu-table-item .btn {
      width: 42%;
      margin: .25rem 2px;
      font-size: 1rem;
    }
    .cart-list, .rekap-list, .top10-list {
      list-style: none;
      padding: 0;
      margin: .5rem 0 0 0;
    }
    .cart-list li, .rekap-list li, .top10-list li {
      border-bottom: 1px solid #eee;
      padding: .4rem 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .text-center { text-align: center; }
    .mb-2 { margin-bottom: .5rem; }
    .mb-3 { margin-bottom: .8rem; }
    .mb-4 { margin-bottom: 1.2rem; }
    .mt-2 { margin-top: .5rem; }
    .mt-4 { margin-top: 1.2rem; }
    .mt-6 { margin-top: 2rem; }
    .fw-bold { font-weight: bold; }
    .text-sm { font-size: .93rem; }
    .text-xs { font-size: .83rem; }
    .modal-bg {
      position: fixed;
      inset: 0; left:0; top:0; width:100vw; height:100vh;
      background: rgba(0,0,0,0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .modal-content {
      background: #fff;
      border-radius: .8rem;
      box-shadow: 0 6px 32px #0003;
      padding: 2rem 1.2rem 1.5rem 1.2rem;
      min-width: 270px;
      max-width: 90vw;
    }
    @media (max-width: 540px) {
      .container { border-radius: 0; box-shadow: none; }
      .form-box { padding: 1.2rem 0.5rem; }
      .modal-content { padding: 1rem .3rem; }
    }
  </style>
</head>
<body>
  <!-- LOGIN -->
  <div id="loginPage" class="page active">
    <div class="form-box">
      <h2 class="font-cafe text-center mb-3" style="color:var(--primary)">Login MissBar Cafe</h2>
      <form onsubmit="event.preventDefault(); loginUser();">
        <input id="loginUsername" class="input" type="text" placeholder="Username" required>
        <input id="loginPassword" class="input" type="password" placeholder="Password" required>
        <button type="submit" class="btn w-full">Login</button>
      </form>
      <div class="my-2 text-center text-xs">atau</div>
      <div class="text-center">
        <!-- Google Sign-In -->
        <div id="g_id_onload"
          data-client_id="596031852783-5pb20oelemtr7g7sdcmh8ievc4pgnuv1.apps.googleusercontent.com"
          data-context="signin"
          data-ux_mode="popup"
          data-callback="handleGoogleLogin"
          data-auto_prompt="false">
        </div>
        <div class="g_id_signin"
          data-type="standard"
          data-shape="rectangular"
          data-theme="outline"
          data-text="sign_in_with"
          data-size="large"
          data-logo_alignment="left">
        </div>
      </div>
      <div class="mt-3 text-center text-sm">
        Belum punya akun? <span class="link" onclick="showPage('register')">Daftar</span>
      </div>
    </div>
  </div>

  <!-- REGISTER -->
  <div id="registerPage" class="page">
    <div class="form-box">
      <h2 class="font-cafe text-center mb-3" style="color:var(--secondary)">Daftar Akun</h2>
      <form onsubmit="event.preventDefault(); registerUser();">
        <input id="regUsername" class="input" type="text" placeholder="Username" required>
        <input id="regPassword" class="input" type="password" placeholder="Password" required>
        <button type="submit" class="btn w-full" style="background:var(--accent)">Daftar</button>
      </form>
      <div class="mt-3 text-center text-sm">
        Sudah punya akun? <span class="link" onclick="showPage('login')">Login</span>
      </div>
    </div>
  </div>

  <!-- MENU -->
  <div id="menuPage" class="page">
    <div class="container">
      <h2 class="font-cafe text-center mb-4" style="color:var(--primary)">Daftar Menu</h2>
      <div id="menuList" class="menu-grid"></div>
    </div>
  </div>

  <!-- KASIR -->
  <div id="kasirPage" class="page">
    <div class="container">
      <h2 class="font-cafe text-center mb-4" style="color:var(--secondary)">Kasir</h2>
      <div id="menuTable" class="menu-table mb-4"></div>
      <h3 class="fw-bold mb-2">Keranjang</h3>
      <ul id="cartList" class="cart-list mb-2"></ul>
      <p class="fw-bold">Total: Rp <span id="cartTotal">0</span></p>
      <button onclick="openCheckoutModal()" class="btn w-full mt-2" style="background:var(--accent)">Checkout</button>
      <h3 class="fw-bold mt-6 mb-2">Transaksi Terakhir</h3>
      <div id="tempTransList"></div>
    </div>
  </div>

  <!-- REKAP -->
  <div id="rekapPage" class="page">
    <div class="container">
      <h2 class="font-cafe text-center mb-4" style="color:var(--primary)">Rekap Penjualan</h2>
      <div class="mb-3 flex flex-wrap gap-2 items-center text-sm">
        <label>Periode:</label>
        <input type="date" id="rekapStart" class="input" style="width:auto;max-width:130px;padding:.3rem .7rem;">
        <span>-</span>
        <input type="date" id="rekapEnd" class="input" style="width:auto;max-width:130px;padding:.3rem .7rem;">
        <button onclick="renderRekap()" class="btn" style="background:var(--accent);font-size:0.93rem;padding:.5rem 1.1rem;">Terapkan</button>
      </div>
      <canvas id="rekapChart" height="125"></canvas>
      <div class="mt-4">
        <h3 class="fw-bold mb-2">Top 10 Penjualan</h3>
        <ol id="top10List" class="top10-list"></ol>
      </div>
    </div>
  </div>

  <!-- MODAL CHECKOUT -->
  <div id="checkoutModal" class="modal-bg" style="display:none">
    <div class="modal-content">
      <h2 class="fw-bold text-center mb-3">Konfirmasi Pembelian</h2>
      <ul id="checkoutList" class="cart-list mb-2"></ul>
      <p class="fw-bold text-center mb-2">TOTAL: Rp <span id="checkoutTotal"></span></p>
      <div class="flex" style="justify-content:space-between;">
        <button onclick="confirmCheckout()" class="btn" style="background:var(--accent)">OK</button>
        <button onclick="closeCheckoutModal()" class="btn" style="background:var(--secondary)">Batal</button>
      </div>
    </div>
  </div>

  <!-- NAVIGATION BAR BAWAH -->
  <nav id="mainNav" class="nav-bottom" style="display:none">
    <button class="nav-btn" id="navMenu" onclick="showPage('menu')">
      <!-- menu icon -->
      <svg width="24" height="24" fill="none" stroke="currentColor"><rect x="4" y="6" width="16" height="2" rx="1"/><rect x="4" y="11" width="16" height="2" rx="1"/><rect x="4" y="16" width="16" height="2" rx="1"/></svg>
      <span class="text-xs">Menu</span>
    </button>
    <button class="nav-btn" id="navKasir" onclick="showPage('kasir')">
      <!-- cart icon -->
      <svg width="24" height="24" fill="none" stroke="currentColor"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l1.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"/></svg>
      <span class="text-xs">Kasir</span>
    </button>
    <button class="nav-btn" id="navRekap" onclick="showPage('rekap')">
      <!-- chart icon -->
      <svg width="24" height="24" fill="none" stroke="currentColor"><rect x="3" y="12" width="4" height="8" rx="1"/><rect x="9" y="8" width="4" height="12" rx="1"/><rect x="15" y="4" width="4" height="16" rx="1"/></svg>
      <span class="text-xs">Rekap</span>
    </button>
    <button class="nav-btn" onclick="logoutUser()">
      <!-- logout icon -->
      <svg width="24" height="24" fill="none" stroke="currentColor"><path d="M17 16l4-4m0 0l-4-4m4 4H7"/><path d="M3 12H7"/></svg>
      <span class="text-xs">Logout</span>
    </button>
  </nav>

  <!-- SCRIPT -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script>
    // Navigation State & Auto Show nav
    function setActiveNav(id) {
      ['navMenu','navKasir','navRekap'].forEach(nid=>{
        document.getElementById(nid).classList.remove('active');
      });
      if(id) document.getElementById(id).classList.add('active');
    }
    window.showPage = function(id) {
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      const target = document.getElementById(id+'Page');
      if(target) target.classList.add('active');
      // Nav show/hide
      document.getElementById('mainNav').style.display =
        (id==='login'||id==='register') ? 'none' : '';
      // Active nav
      setActiveNav(id==='menu'?'navMenu':id==='kasir'?'navKasir':id==='rekap'?'navRekap':null);
      // Render otomatis
      if(id==='menu' && typeof renderMenuList==='function') renderMenuList();
      if(id==='kasir' && typeof renderMenuTable==='function') renderMenuTable();
      if(id==='kasir' && typeof renderCart==='function') renderCart();
      if(id==='kasir' && typeof renderTempTrans==='function') renderTempTrans();
      if(id==='rekap' && typeof renderRekap==='function') renderRekap();
    }
    // Modal
    function openCheckoutModal(){ document.getElementById('checkoutModal').style.display='flex'; }
    function closeCheckoutModal(){ document.getElementById('checkoutModal').style.display='none'; }
  </script>
  <script src="app.js"></script>
</body>
</html>
